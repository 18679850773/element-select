function ElementSelect(t){this.config=this.initConfig(t);this.rootDom&&this.destroy(),this.createBox(),this.handleMode(function(){document.body.style.userSelect="none",this.status="start",this.rootDom.style.display="block",this.mousedownbind=this.mousedown.bind(this),this.rootDom.addEventListener("mousedown",this.mousedownbind)},function(){document.body.style.userSelect="auto","move"==this.status&&this.mouseup(),this.status="end",this.rootDom.style.display="none",this.rootDom.removeEventListener("mousedown",this.mousedownbind,!1)})}ElementSelect.prototype.handleMode=function(e,o){var t=["ctrl","shift","alt"];if("handle"!=this.config.startMode&&t.includes(this.config.startMode))this.keydownbind=function(t){("ctrl"==this.config.startMode&&"Control"==t.key||"alt"==this.config.startMode&&"Alt"==t.key||"shift"==this.config.startMode&&"Shift"==t.key)&&["create","end"].includes(this.status)&&e.call(this)}.bind(this),document.addEventListener("keydown",this.keydownbind);else{if("handle"!=this.config.startMode)throw"config.startMode暂不支持其他模式";ElementSelect.prototype.start=e.bind(this)}if("handle"!=this.config.endMode&&t.includes(this.config.endMode))this.keyupbind=function(t){("ctrl"==this.config.startMode&&"Control"==t.key||"alt"==this.config.startMode&&"Alt"==t.key||"shift"==this.config.startMode&&"Shift"==t.key)&&o.call(this)}.bind(this),document.addEventListener("keyup",this.keyupbind);else if("handle"==this.config.endMode)ElementSelect.prototype.end=o.bind(this);else if("auto"!=this.config.endMode)throw"config.endMode暂不支持其他模式"},ElementSelect.prototype.initConfig=function(t){t={el:"",boxStyle:"",startMode:"ctrl",endMode:"ctrl",model:"<div></div>",...t};if(this.status="",t.el.constructor!=String)throw"config.el选择器为必填项，且值为String类型";if(!t.el)throw"config.el为必填项，影响可选标签范围！";if(this.locator=t.el,t.el=t.el.split(",").reduce((t,e)=>(t[e.trim()]=document.querySelectorAll(e.trim()))&&t,Object.create(null)),Object.values(t.el).reduce((t,e)=>t+e.length,0))return t;throw"config.el找不到对应的标签"},ElementSelect.prototype.createBox=function(){this.status="create";var t=document.createElement("div"),e=document.createElement("span"),o=(t.style="position:fixed;top:0;left:0;right:0;bottom:0;display:none;",e.style="border:1px solid #409eff;background-color:rgba(255, 255, 255,0.1);"+this.config.boxStyle+";position:absolute;",document.createElement("div"));o.innerHTML=this.config.model,t.append(e,o.children[0]),document.body.append(t),o.remove(),ElementSelect.prototype.rootDom=t,ElementSelect.prototype.selectBox=e},ElementSelect.prototype.mousedown=function(t){if(0<t.button)return!1;this.status="down";var e=this.selectBox;e.style.top=t.y+"px",e.style.left=t.x+"px",e.style.display="block",this.startXY={x:t.x,y:t.y},this.mousemovebind=this.mousemove.bind(this),this.mouseupbind=this.mouseup.bind(this),this.rootDom.addEventListener("mousemove",this.mousemovebind),this.rootDom.addEventListener("mouseup",this.mouseupbind)},ElementSelect.prototype.mousemove=function(t){this.status="move";var e=this.selectBox;e.style.width=Math.abs(t.x-this.startXY.x)+"px",e.style.height=Math.abs(t.y-this.startXY.y)+"px",t.x-this.startXY.x<0&&(e.style.left=t.x+"px"),t.y-this.startXY.y<0&&(e.style.top=t.y+"px")},ElementSelect.prototype.mouseup=function(){this.status="up";var t=this.selectBox;this.computeSelectElement(t.getBoundingClientRect()),t.style.width=0,t.style.height=0,t.style.display="none",this.rootDom.removeEventListener("mousemove",this.mousemovebind,!1),this.rootDom.removeEventListener("mouseup",this.mouseupbind,!1)},ElementSelect.prototype.start=function(){throw"config.startMode的值应该设置成 handle，才能手动控制start"},ElementSelect.prototype.end=function(){"move"==this.status&&this.mouseup(),this.status="end",this.rootDom.style.display="none",this.rootDom.removeEventListener("mousedown",this.mousedownbind,!1)},ElementSelect.prototype._select=function(t){var s={};if(this.config.dataset){const o={String:(t,e)=>{s[e].push(t.dataset[this.config.dataset]||"")},Array:(o,t)=>{s[t].push(this.config.dataset.reduce((t,e)=>(!o.dataset[e]||(t[e]=o.dataset[e]))&&t,Object.create(null)))},Object:(o,t)=>{s[t].push(this.config.dataset[t].reduce((t,e)=>(!o.dataset[e]||(t[e]=o.dataset[e]))&&t,Object.create(null)))}};if(!o[this.config.dataset.constructor.name])throw"config.dataset格式不支持！";Object.keys(t).forEach(e=>{s[e]=[],t[e].forEach(t=>o[this.config.dataset.constructor.name](t,e))})}"auto"==this.config.endMode&&this.end(),this.select(t,s)},ElementSelect.prototype.select=function(t,e){},ElementSelect.prototype.getFilterDoms=function(t){return t.split(",").reduce((t,e)=>(t[e.trim()]=[],t),Object.create(null))},ElementSelect.prototype.computeSelectElement=function(s){var i=this.getFilterDoms(this.locator);Object.keys(i).forEach(o=>{this.config.el[o].forEach(t=>{var e=t.getBoundingClientRect();e.bottom>s.top&&e.top<s.bottom&&!(e.right<s.left||e.left>s.right)&&i[o].push(t)})}),this._select(i)},ElementSelect.prototype.destroy=function(){this.status="destroy",document.removeEventListener("keydown",this.keydownbind,!1),document.removeEventListener("keyup",this.keyupbind,!1),this.rootDom.remove()};export default ElementSelect;